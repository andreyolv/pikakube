apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: zitadel
  namespace: zitadel
spec:
  interval: 5m
  chart:
    spec:
      chart: zitadel
      version: 8.8.1
      sourceRef:
        kind: HelmRepository
        name: zitadel
        namespace: flux-system
  valuesFrom:
  - kind: Secret
    name: postgres
    valuesKey: password
    targetPath: zitadel.secretConfig.Database.postgres.User.Password
  values:
  # https://artifacthub.io/packages/helm/zitadel/zitadel
  # https://github.com/zitadel/zitadel-charts/blob/main/charts/zitadel/values.yaml
    zitadel:
      masterkey: vZxrx44yXBWOSgvVwzIK58Lg9S5EGAyM
      configmapConfig:
        ExternalSecure: false
        ExternalDomain: 127.0.0.1.sslip.io
        TLS:
          Enabled: false
        Database:
          Postgres:
            Host: postgres.zitadel.svc.cluster.local
            Port: 5432
            Database: zitadel
            MaxOpenConns: 20
            MaxIdleConns: 10
            MaxConnLifetime: 30m
            MaxConnIdleTime: 5m
            User:
              Username: zitadel
              SSL:
                Mode: disable
            Admin:
              Username: zitadel
              SSL:
                Mode: disable
    replicaCount: 1