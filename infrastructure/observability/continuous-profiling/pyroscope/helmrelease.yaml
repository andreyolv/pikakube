apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: pyroscope
  namespace: pyroscope
spec:
  interval: 5m
  chart:
    spec:
      chart: pyroscope
      version: 1.13.0
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: flux-system
  values:
  # https://artifacthub.io/packages/helm/grafana/pyroscope
  # https://github.com/grafana/pyroscope/blob/next/operations/pyroscope/helm/pyroscope/values.yaml
    pyroscope:
      components:
        querier:
          kind: Deployment
          replicaCount: 1
        query-frontend:
          kind: Deployment
          replicaCount: 1
        query-scheduler:
          kind: Deployment
          replicaCount: 1
        distributor:
          kind: Deployment
          replicaCount: 1
        ingester:
          kind: StatefulSet
          replicaCount: 1
        store-gateway:
          kind: StatefulSet
          replicaCount: 1
          persistence:
            enabled: false
    minio:
      enabled: true
    ingress:
      enabled: true
      hosts:
      - pyroscope.127.0.0.1.nip.io

